# transform-cases.md

æœ¬æ–‡ä»¶è®°å½• OT transform çš„æ ¸å¿ƒæµ‹è¯•åœºæ™¯çŸ©é˜µï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ç§ opA ä¸ opB çš„ç»„åˆå˜æ¢å…³ç³»ï¼Œç”¨äºå¼•å¯¼ engine å±‚çš„ transform æµ‹è¯•ç”¨ä¾‹è®¾è®¡ã€‚

---

## ğŸ§  åŸºæœ¬å®šä¹‰

- opAï¼šå…ˆåº”ç”¨çš„æ“ä½œï¼ˆå·²åœ¨æ–‡æ¡£ä¸Šï¼‰
- opBï¼šååˆ°çš„æ“ä½œï¼ˆéœ€ transformï¼‰
- transform(opA, opB) è¡¨ç¤ºï¼š**è®© opB é€‚åº” opA å·²åº”ç”¨åçš„æ–‡æ¡£çŠ¶æ€**

---

## âœ… æµ‹è¯•çŸ©é˜µ

| ç¼–å· | opA ç±»å‹ | opB ç±»å‹ | ç¤ºä¾‹ç®€è¿°                                                | é¢„æœŸè¡Œä¸º                                            | åº”ç”¨åœºæ™¯       |
| ---- | -------- | -------- | ------------------------------------------------------- | --------------------------------------------------- | -------------- |
| 1    | insert   | insert   | A: insert("A", 0) / B: insert("B", 0)                   | B è¢«å³ç§»ï¼Œç»“æœåº”ä¸º "AB..." æˆ– "BA..."ï¼ˆç”±å…ˆåå†³å®šï¼‰ | å…‰æ ‡ä½ç½®å†²çª   |
| 2    | insert   | delete   | A: insert("A", 0) / B: delete(0,1)                      | åˆ é™¤ä½ç½®è¢«å³ç§»                                      | æ’å…¥åå†åˆ      |
| 3    | delete   | insert   | A: delete(0,1) / B: insert("B", 0)                      | æ’å…¥ä½ç½®è¢«å·¦ç§»                                      | åˆ é™¤ç©ºéš™æ’å…¥   |
| 4    | delete   | delete   | A: delete(0,2) / B: delete(1,2)                         | èŒƒå›´åˆå¹¶æˆ–éƒ¨åˆ†è£å‰ª                                  | è¿ç»­åˆ /é‡å åˆ   |
| 5    | retain   | insert   | A: retain(1) / B: insert("B", 1)                        | insert ä½ç½®è¢«æ­£ç¡®åç§»                               | å…‰æ ‡é—´æ’å…¥     |
| 6    | retain   | delete   | A: retain(2) / B: delete(2,1)                           | delete ä½ç½®åç§»                                     | æ»šåŠ¨åˆ é™¤       |
| 7    | insert   | retain   | A: insert("A", 0) / B: retain(1)                        | retain åç§»                                         | æ–‡æœ¬åŒæ­¥       |
| 8    | delete   | retain   | A: delete(0,1) / B: retain(1)                           | retain ç¼©çŸ­                                         | åŒæ­¥è·Ÿéš       |
| 9    | retain   | retain   | A: retain(2) / B: retain(2)                             | ä¸å˜                                                | å¸¸è§„åŒæ­¥       |
| 10   | noop     | insert   | A: âˆ… / B: insert("B", 0)                                | ä¿æŒ insert ä¸å˜                                    | åˆå§‹æ’å…¥       |
| 11   | noop     | delete   | A: âˆ… / B: delete(0,1)                                   | ä¿æŒ delete ä¸å˜                                    | åˆå§‹æ¸…ç©º       |
| 12   | delete   | noop     | A: delete(0,2) / B: âˆ…                                   | ä¸å½±å“ noop                                         | ä¸æ“ä½œæ— æ•ˆåŒ–   |
| 13   | insert   | noop     | A: insert("A", 0) / B: âˆ…                                | ä¸å½±å“ noop                                         | ä¸æ“ä½œæ— æ•ˆåŒ–   |
| 14   | retain   | retain   | A: retain(2, {bold:true}) / B: retain(2, {italic:true}) | å±æ€§åˆå¹¶æˆ–è¦†ç›–                                      | å¯Œæ–‡æœ¬æ ·å¼å˜æ›´ |

---

## ğŸ“¦ è¯´æ˜

- âœ… ä»¥ä¸Šæµ‹è¯•åº”é€æ¡åœ¨ engine å±‚ä»¥ Vitest ç¼–å†™ç‹¬ç«‹ç”¨ä¾‹
- âœ… æ¯ç§ç»„åˆåº”æµ‹è¯•å…‰æ ‡ä¸åŒä½ç½®ã€è¾¹ç•Œæƒ…å†µï¼ˆ0ã€æœ«å°¾ï¼‰ã€é‡å èŒƒå›´ç­‰è¾¹ç¼˜æƒ…å†µ
- âœ… ç”¨ä¾‹åº”è¦†ç›– insert/retain/delete ç»„åˆçš„æ‰€æœ‰å¯èƒ½å˜æ¢è·¯å¾„
- âœ… å¯¹äºæ¯ä¸ªæµ‹è¯•ç»“æœï¼Œåº” assert æœ€ç»ˆ compose(base + opA + opBâ€²) çš„ Delta æ­£ç¡®æ€§

---

## â­ï¸ åç»­æ‹“å±•å»ºè®®

- [ ] æ”¯æŒ attributesï¼ˆå¦‚ boldã€italicï¼‰å˜æ›´çš„ transform
- [ ] å¤åˆ Deltaï¼šä¸€ä¸ª Delta åŒ…å«å¤šä¸ªæ“ä½œçš„ transform è·¯å¾„ï¼ˆå¤æ‚æ··åˆåœºæ™¯ï¼‰
- [ ] ç©º Delta çš„å¤„ç†ï¼ˆnoopï¼‰
- [ ] éšå¼ retainï¼ˆè·³è¿‡æ— æ„ä¹‰ retainï¼‰

---

## â— ç‰ˆæœ¬å·å’Œåºåˆ—å·æç¤º

- å½“å‰æµ‹è¯•é›†ä¸­æœªæ¶‰åŠç‰ˆæœ¬å·ï¼ˆversionï¼‰å’Œåºåˆ—å·ï¼ˆseqï¼‰æ¦‚å¿µï¼Œæ‰€æœ‰æ“ä½œè§†ä¸ºæ— ç‰ˆæœ¬ã€‚
- åœ¨å®é™…ååŒç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ç«¯ä¼šæ ¹æ®ç‰ˆæœ¬å·é¡ºåºæ‰§è¡Œ transformï¼Œç¡®ä¿æ“ä½œçš„æœ‰åºæ€§ã€‚
- ç‰ˆæœ¬æ§åˆ¶åº”åœ¨ OTSession å±‚ç®¡ç†ï¼ŒEngine å±‚ä¿æŒçº¯ç²¹çš„ transform åŠŸèƒ½ã€‚

---

## ğŸ§ª æ¨èæµ‹è¯•æ–‡ä»¶å‘½åå’Œå¯¹åº”å…³ç³»

| æµ‹è¯•æ–‡ä»¶                        | ä¸»è¦æµ‹è¯•å†…å®¹     |
| ------------------------------- | ---------------- |
| simple-transform.test.ts        | åŸºç¡€æ’å…¥åœºæ™¯     |
| insert-insert-transform.test.ts | æ’å…¥-æ’å…¥å†²çª    |
| insert-delete-transform.test.ts | æ’å…¥-åˆ é™¤äº¤äº’    |
| delete-delete-transform.test.ts | åˆ é™¤-åˆ é™¤å†²çª    |
| retain-insert-transform.test.ts | retain ä¸ insert |
| retain-delete-transform.test.ts | retain ä¸ delete |
| retain-retain-transform.test.ts | retain å±æ€§å˜æ›´  |
| multi-op-transform.test.ts      | å¤æ‚ç»„åˆå¤šæ“ä½œ   |
| noop-transform.test.ts          | ç©ºæ“ä½œï¼ˆnoopï¼‰   |

---

## æ¨èæµ‹è¯•æ–‡ä»¶æ‰§è¡Œé¡ºåº

1. insert-insert-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- åŸºç¡€çš„æ’å…¥å†²çªï¼ŒéªŒè¯ transform æ ¸å¿ƒè¡Œä¸ºã€‚
2. insert-insert-priority-transform.test.ts ï¼ˆå·²å®Œæˆï¼‰ã€‚- ä¼˜å…ˆçº§æµ‹è¯•ï¼ŒéªŒè¯ insert-insert å†²çªçš„ä¼˜å…ˆçº§ã€‚
3. insert-delete-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- æ’å…¥ä¸åˆ é™¤æ··åˆï¼Œä½ç½®è°ƒæ•´è¾ƒå¤æ‚ï¼Œç´§æ¥ç€æ’å…¥æµ‹è¯•ï¼Œä¿è¯åˆ é™¤åœ¨æ’å…¥åæ­£ç¡®åç§»ã€‚
4. delete-insert-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- åˆ é™¤ä¸æ’å…¥é¡ºåºè°ƒæ¢ï¼Œè¿›ä¸€æ­¥éªŒè¯æ’å…¥å¦‚ä½•é€‚åº”å·²åˆ æ–‡æœ¬ã€‚
5. delete-delete-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- åˆ é™¤-åˆ é™¤å†²çªï¼Œè¦†ç›–é‡å åˆ é™¤å’ŒèŒƒå›´åˆå¹¶ï¼Œéš¾åº¦è¾ƒé«˜ã€‚
6. retain-insert-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- å…‰æ ‡ä¿ç•™ä¸æ’å…¥ï¼Œä¸»è¦è€ƒå¯Ÿ retain å½±å“ã€‚
7. retain-delete-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- å…‰æ ‡ä¿ç•™ä¸åˆ é™¤ï¼Œè€ƒå¯Ÿ retain å¯¹åˆ é™¤çš„åç§»ã€‚
8. insert-retain-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- æ’å…¥æ“ä½œå¯¹ retain çš„å½±å“ï¼Œä¸»è¦æ˜¯å±æ€§å’Œå…‰æ ‡çš„è°ƒæ•´ã€‚
9. retain-retain-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- ä¸¤ä¸ª retain æ“ä½œï¼Œé’ˆå¯¹å±æ€§å˜æ›´å’Œæ— ä½ç½®å˜æ›´çš„æƒ…å†µã€‚
10. multi-op-transform.test.tsï¼ˆå·²å®Œæˆï¼‰ã€‚- ç»¼åˆå¤šä¸ªæ“ä½œç»„åˆï¼Œå¤æ‚åœºæ™¯ï¼ŒéªŒè¯æ•´ä½“ç¨³å®šæ€§ã€‚
